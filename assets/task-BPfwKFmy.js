import{_ as me,v as pe,n as _e,b as d,r as fe,y as ge,c as $,e as s,$ as ve,o as u,f as z,q as L,l as e,k as a,u as n,z as he,j as _,L as R,d as we,a0 as h,G as x,F as H,g as M,E as r,t as D,K as be,x as ye}from"./element-Di_zbn_f.js";import{g as ke,r as U,a as Ce,s as xe,b as De}from"./task-cmnfkzQF.js";import{e as Te}from"./element-resize-detector-BdDcWLZ0.js";import Be from"./detail-CAqLIs0b.js";const Ve={class:"content-div"},Ne={class:"search-div"},je={class:"button-div"},ze=we({name:"task"}),Le=Object.assign(ze,{setup(Ee){pe(()=>{Te().listenTo(document.getElementsByClassName("search-div"),()=>{_e(()=>{let o=document.getElementsByClassName("el-container")[0].clientHeight;document.getElementsByClassName("search-div")[0].clientHeight<100?B.value=o-250+"px":B.value=o-290+"px"})})});const w=d(1),T=d(20),E=d(0),B=d(500),b=d(!1),m=d(!1),y=d(!1),k=d(!1);d([]);const i=fe({selectionList:[],query:{jobName:"",jobBeanName:""},tableData:[],nextTimeList:[],rowData:{}}),{selectionList:qe,query:f,tableData:K,nextTimeList:F,rowData:O}=ge(i),V=$(()=>ye().dicData.taskType||[]);$(()=>{let l=[];return i.selection.forEach(o=>{l.push(o.id)}),l.join(",")});const c=()=>{b.value=!0;let l={};Object.keys(i.query).forEach(o=>{i.query[o]&&(l[o]=i.query[o])}),ke(w.value,T.value,l).then(o=>{i.tableData=o.data.data.records||[],E.value=o.data.data.total,b.value=!1}).catch(()=>b.value=!1)},P=()=>{w.value=1,c()},A=()=>{i.query.jobName="",i.query.jobBeanName="",c()},G=l=>{T.value=l,c()},I=l=>{w.value=l,c()},J=l=>{i.selectionList=l},Q=()=>{i.rowData={},k.value=!0,m.value=!0},W=l=>{i.rowData=l,k.value=!1,m.value=!0},X=()=>{if(i.selectionList.length===0){h.warning("请选择至少一条数据");return}x.confirm("确定将选择数据删除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>U(i.selectionList)).then(()=>{c(),h({type:"success",message:"操作成功!"})})},Y=l=>{x.confirm("确定将选择数据删除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>U([l])).then(()=>{c(),h({type:"success",message:"操作成功!"})})},Z=l=>{Ce({id:l.id}).then(o=>{y.value=!0,i.nextTimeList=o.data.data||[]}).catch(()=>i.nextTimeList=[])},ee=l=>{x.confirm("确定暂停任务?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>xe([l])).then(()=>{c(),h({type:"success",message:"任务暂停成功!"})})},te=l=>{x.confirm("确定恢复任务?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>De([l])).then(()=>{c(),h({type:"success",message:"任务恢复成功!"})})};return c(),(l,o)=>{const q=s("el-input"),N=s("el-form-item"),ae=s("el-option"),oe=s("el-select"),g=s("el-button"),le=s("el-form"),p=s("el-table-column"),j=s("el-tag"),ne=s("arrow-down"),se=s("el-icon"),v=s("el-dropdown-item"),ie=s("el-dropdown-menu"),re=s("el-dropdown"),ce=s("el-table"),de=s("el-pagination"),S=s("el-dialog"),ue=ve("loading");return u(),z("div",Ve,[L("div",Ne,[e(le,{inline:!0,model:n(f),class:"demo-form-inline"},{default:a(()=>[e(N,{label:"任务名称:"},{default:a(()=>[e(q,{modelValue:n(f).jobName,"onUpdate:modelValue":o[0]||(o[0]=t=>n(f).jobName=t),placeholder:"任务名称",size:"small",clearable:""},null,8,["modelValue"])]),_:1}),e(N,{label:"任务类型:"},{default:a(()=>[e(oe,{modelValue:n(f).jobBeanName,"onUpdate:modelValue":o[1]||(o[1]=t=>n(f).jobBeanName=t),size:"small",style:{width:"100%"},placeholder:"任务类型",clearable:""},{default:a(()=>[(u(!0),z(H,null,M(n(V),t=>(u(),_(ae,{key:t.dictKey,label:t.dictValue,value:t.dictKey},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(N,null,{default:a(()=>[e(g,{type:"primary",onClick:P,size:"small",icon:"Search"},{default:a(()=>[r("查询")]),_:1}),e(g,{onClick:A,size:"small",icon:"Refresh"},{default:a(()=>[r("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),L("div",je,[e(g,{type:"primary",onClick:Q,size:"small",icon:"Plus"},{default:a(()=>[r("新增")]),_:1}),e(g,{type:"danger",onClick:X,size:"small",icon:"Minus"},{default:a(()=>[r("批量删除")]),_:1})]),he((u(),_(ce,{data:n(K),ref:"tableDataRef",height:n(B),border:"",style:{width:"100%"},"element-loading-text":"加载中","element-loading-spinner":"el-icon-loading",onSelectionChange:J},{default:a(()=>[e(p,{type:"selection",width:"55"}),e(p,{prop:"jobName",label:"任务名称","show-overflow-tooltip":""}),e(p,{prop:"jobBeanName",label:"任务类型","show-overflow-tooltip":""},{default:a(t=>[L("span",null,D(l.getDictValue(t.row.jobBeanName,n(V))),1)]),_:1}),e(p,{prop:"jobDesc",label:"任务描述","show-overflow-tooltip":""}),e(p,{prop:"cronExpression",label:"cron表达式",width:"160","show-overflow-tooltip":""}),e(p,{prop:"v1",label:"运行状态",width:"110","show-overflow-tooltip":""},{default:a(t=>[t.row.v1==="暂停中"?(u(),_(j,{key:0,size:"small",type:"warning"},{default:a(()=>[r(D(t.row.v1),1)]),_:2},1024)):(u(),_(j,{key:1,size:"small"},{default:a(()=>[r(D(t.row.v1),1)]),_:2},1024))]),_:1}),e(p,{fixed:"right",label:"操作",width:"220"},{default:a(t=>[e(re,null,{dropdown:a(()=>[e(ie,{slot:"dropdown"},{default:a(()=>[e(v,{onClick:C=>Z(t.row)},{default:a(()=>[r("下次执行时间")]),_:2},1032,["onClick"]),e(v,{onClick:C=>W(t.row)},{default:a(()=>[r("编辑")]),_:2},1032,["onClick"]),e(v,{onClick:C=>Y(t.row)},{default:a(()=>[r("删除")]),_:2},1032,["onClick"]),e(v,{onClick:C=>ee(t.row)},{default:a(()=>[r("暂停")]),_:2},1032,["onClick"]),e(v,{onClick:C=>te(t.row)},{default:a(()=>[r("恢复")]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[e(g,{type:"primary",size:"small",class:"operating-button"},{default:a(()=>[r(" 操 作 "),e(se,{class:"el-icon--right"},{default:a(()=>[e(ne)]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data","height"])),[[ue,n(b)]]),e(de,{onSizeChange:G,onCurrentChange:I,"current-page":n(w),"page-sizes":[10,20,50,100],"page-size":n(T),layout:"->, total, sizes, prev, pager, next",total:n(E)},null,8,["current-page","page-size","total"]),e(S,{title:n(k)?"新增":"编辑","close-on-click-modal":!1,"close-on-press-escape":!1,modelValue:n(m),"onUpdate:modelValue":o[4]||(o[4]=t=>R(m)?m.value=t:null)},{default:a(()=>[n(m)?(u(),_(n(Be),{key:0,ref:"taskDetail","row-data":n(O),"java-bean-list":n(V),"is-add":n(k),onRefreshData:o[2]||(o[2]=t=>{m.value=!1,c()}),onCancelData:o[3]||(o[3]=t=>m.value=!1)},null,8,["row-data","java-bean-list","is-add"])):be("",!0)]),_:1},8,["title","modelValue"]),e(S,{title:"下次执行时间","close-on-click-modal":!1,"close-on-press-escape":!1,modelValue:n(y),"onUpdate:modelValue":o[5]||(o[5]=t=>R(y)?y.value=t:null),width:"30%"},{default:a(()=>[(u(!0),z(H,null,M(n(F),t=>(u(),_(j,{key:t,style:{margin:"5px 10px"}},{default:a(()=>[r(D(t),1)]),_:2},1024))),128))]),_:1},8,["modelValue"])])}}}),Me=me(Le,[["__scopeId","data-v-d2bbd883"]]);export{Me as default};
