import{_ as Be,v as Ne,n as te,b as r,r as Se,y as $e,c as M,w as Fe,e as p,$ as qe,o as f,f as le,q as c,l as a,k as s,u as t,j as h,K as V,z as R,B as O,A as He,E as d,t as H,L as P,d as Ue,a0 as y,G as Ee,m as Me,H as Re,I as Oe,M as Pe,x as je,a1 as ae,a2 as Ke}from"./element-Di_zbn_f.js";import{g as Le,b as Ae,r as Ge,c as We,s as Je,d as Qe,e as Xe,f as Ye}from"./main-CUtMfDLK.js";import{g as Ze}from"./menu-AIPFbCUU.js";import{e as et}from"./element-resize-detector-BdDcWLZ0.js";const tt=N=>(Re("data-v-d0d1453f"),N=N(),Oe(),N),lt={class:"content-div"},at={class:"search-div"},st={class:"button-div"},ot={class:"title"},nt=tt(()=>c("span",null,null,-1)),rt={style:{"padding-left":"4px","font-size":"12px"}},it={class:"operation-btn"},dt={class:"detail-div"},ut={style:{"font-size":"12px"}},ct={slot:"footer",class:"dialog-footer",style:{"text-align":"right"}},mt={slot:"footer",class:"dialog-footer",style:{"text-align":"right"}},pt=Ue({name:"ledgerInfo"}),ft=Object.assign(pt,{setup(N){Ne(()=>{et().listenTo(document.getElementsByClassName("search-div"),()=>{te(()=>{let e=document.getElementsByClassName("el-container")[0].clientHeight;document.getElementsByClassName("search-div")[0].clientHeight<100?U.value=e-250+"px":U.value=e-290+"px"})}),W.value=document.getElementsByClassName("el-container")[0].clientHeight-260});const{proxy:i}=Pe(),k=r(1),j=r(20),K=r(0),U=r(500),S=r(!1),L=r("权限配置"),C=r(!1),_=r(!1),z=r(!1),D=r(!1),$=r(""),F=r(!1),E=r(""),A=r(""),q=r(""),G=r(""),W=r(0),n=Se({query:{account:"",name:""},orgTypes:[],organization:{orgName:"",orgType:"",regionLevel:"",businessGuideDept:"",memberNum:"",primaryDuty:"",regionID:-1,regionType:-1,regionName:""},tableData:[],selection:[],formInline:{account:"",name:"",phone:"",password:"",deptId:"",deptName:""},rules:{account:[{required:!0,message:"登录账号不能为空",trigger:"blur"}],name:[{required:!0,message:"用户姓名不能为空",trigger:"blur"}],deptName:[{required:!0,message:"所属机构不能为空",trigger:"blur"}],password:[{required:!0,message:"登录密码不能为空",trigger:"blur"}]},orgTreeData:[],defaultOrgProps:{children:"children",label:"title"},menuTreeData:[],defaultMenuProps:{children:"children",label:"name"},defaultCheckedKeys:[]}),{query:x,orgTypes:gt,organization:vt,tableData:se,selection:ht,formInline:m,rules:oe,orgTreeData:ne,defaultOrgProps:re,menuTreeData:ie,defaultMenuProps:de,defaultCheckedKeys:yt}=$e(n),I=M(()=>je().permission),T=M(()=>({addBtn:i.vaildData(I.value,"user_add"),delBtn:i.vaildData(I.value,"user_del"),editBtn:i.vaildData(I.value,"user_update"),resetBtn:i.vaildData(I.value,"user_reset"),authBtn:i.vaildData(I.value,"user_auth")})),J=M(()=>{let l=[];return n.selection.forEach(e=>{l.push(e.id)}),l.join(",")});Fe(()=>$.value,l=>{i.$refs.orgTree.filter(val)});const ue=()=>{Promise.all([Le(),Ze()]).then(l=>{n.orgTreeData=l[0].data.data||[],n.menuTreeData=l[1].data.data||[]})},g=()=>{S.value=!0,Object.keys(n.query).forEach(l=>{n.query[l]&&n.query[l]}),Ae({current:k.value,...n.query}).then(l=>{n.tableData=l.data.data.records||[],K.value=l.data.data.total,S.value=!1}).catch(()=>S.value=!1)},ce=()=>{k.value=1,g()},me=()=>{n.query={account:"",name:""},k.value=1,g()},pe=l=>{j.value=l,g()},fe=l=>{k.value=l,g()},ge=()=>{n.selection.length===0&&y.warning("请先选择数据"),Ge({userIds:J.value}).then(()=>{y.value({type:"success",message:"操作成功!"}),k.value=1,g()})},ve=()=>{if(n.selection.length===0){y.warning("请先选择数据");return}Ee.confirm("确定将选择数据删除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>We({ids:J.value})).then(()=>{y({type:"success",message:"操作成功!"}),k.value=1,g()}).catch(()=>{y({type:"info",message:"已取消删除"})})},he=(l,e)=>l?e.label.indexOf(l)!==-1:!0,ye=(l,e)=>e.category&&e.category==="2"?"StarFilled":e.icon&&e.category&&(e.category==="1"||e.category==="3")?e.icon:l.expanded?"FolderOpened":"Folder",_e=l=>{n.selection=l},be=()=>{n.formInline={account:"",name:"",phone:"",password:"",deptId:"",deptName:""},q.value=!0,i.$refs.userForm&&i.$refs.userForm.resetFields(),_.value=!0},ke=l=>{G.value=l.password,n.formInline=ae(l),q.value=!1,i.$refs.userForm&&i.$refs.userForm.resetFields(),_.value=!0},Ce=()=>{i.$refs.userForm.validate(l=>{if(l){C.value=!0;let e=ae(n.formInline);G.value!==n.formInline.password&&(e.password=Ke(e.password)),q.value?Qe(e).then(()=>{y({type:"success",message:"新增成功!"}),C.value=!1,i.$refs.userForm.resetFields(),_.value=!1,g()}).catch(()=>C.value=!1):Xe(e).then(()=>{y({type:"success",message:"修改成功!"}),C.value=!1,i.$refs.userForm.resetFields(),_.value=!1,g()}).catch(()=>C.value=!1)}else return!1})},Ve=l=>{n.formInline=l,L.value=`权限[${n.formInline.name}]`,Ye({userId:l.id}).then(e=>{D.value=!0,te(()=>{i.$refs.menuTree.setCheckedKeys(e.data.data)})})},ze=l=>{E.value=l.deptId,A.value=l.deptName},De=()=>{if(!E.value){y.warning("请选择机构");return}n.formInline.deptId=E.value,n.formInline.deptName=A.value,z.value=!1},we=()=>{let l=i.$refs.menuTree.getCheckedKeys().concat(i.$refs.menuTree.getHalfCheckedKeys()).filter(e=>e!=="1").join(",");F.value=!0,Je({menuIds:l,userId:n.formInline.id}).then(()=>{y({type:"success",message:"操作成功!"}),F.value=!1,D.value=!1}).catch(()=>F.value=!1)};return g(),ue(),(l,e)=>{const v=p("el-input"),b=p("el-form-item"),u=p("el-button"),Q=p("el-form"),B=p("el-table-column"),xe=p("el-table"),Ie=p("el-pagination"),X=p("el-icon"),Y=p("el-tree"),Te=p("Help"),Z=p("el-dialog"),ee=qe("loading");return f(),le("div",lt,[c("div",{class:"left-div",style:O({width:t(D)?"70%":"100%"})},[c("div",at,[a(Q,{inline:!0,model:t(x),class:"demo-form-inline"},{default:s(()=>[a(b,{label:"登录账号:"},{default:s(()=>[a(v,{modelValue:t(x).account,"onUpdate:modelValue":e[0]||(e[0]=o=>t(x).account=o),placeholder:"登录账号",size:"small",clearable:""},null,8,["modelValue"])]),_:1}),a(b,{label:"用户名:"},{default:s(()=>[a(v,{modelValue:t(x).name,"onUpdate:modelValue":e[1]||(e[1]=o=>t(x).name=o),placeholder:"用户名",size:"small",clearable:""},null,8,["modelValue"])]),_:1}),a(b,null,{default:s(()=>[a(u,{type:"primary",onClick:ce,size:"small",icon:"Search"},{default:s(()=>[d("查询")]),_:1}),a(u,{onClick:me,size:"small",icon:"Refresh"},{default:s(()=>[d("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),c("div",st,[t(T).addBtn?(f(),h(u,{key:0,type:"primary",onClick:be,size:"small",icon:"Plus"},{default:s(()=>[d("新增")]),_:1})):V("",!0),t(T).resetBtn?(f(),h(u,{key:1,type:"primary",onClick:ge,size:"small",icon:"Refresh"},{default:s(()=>[d("重置密码")]),_:1})):V("",!0),t(T).delBtn?(f(),h(u,{key:2,type:"danger",onClick:ve,size:"small",icon:"Minus"},{default:s(()=>[d("批量删除")]),_:1})):V("",!0)]),R((f(),h(xe,{data:t(se),ref:"tableDataRef",height:t(U),border:"",style:{width:"100%"},"element-loading-text":"加载中","element-loading-spinner":"el-icon-loading",onSelectionChange:_e},{default:s(()=>[a(B,{type:"selection",width:"55"}),a(B,{prop:"account",label:"登录账号"}),a(B,{prop:"name",label:"用户名"}),a(B,{prop:"deptName",label:"所属机构"}),a(B,{fixed:"right",label:"操作",width:"150"},{default:s(o=>[t(T).editBtn?(f(),h(u,{key:0,type:"primary",onClick:w=>ke(o.row),size:"small",icon:"Edit",link:""},{default:s(()=>[d("修改")]),_:2},1032,["onClick"])):V("",!0),t(T).authBtn?(f(),h(u,{key:1,type:"primary",onClick:w=>Ve(o.row),size:"small",icon:"View",link:""},{default:s(()=>[d("权限")]),_:2},1032,["onClick"])):V("",!0)]),_:1})]),_:1},8,["data","height"])),[[ee,t(S)]]),a(Ie,{onSizeChange:pe,onCurrentChange:fe,"current-page":t(k),"page-sizes":[10,20,50,100],"page-size":t(j),layout:"->, total, sizes, prev, pager, next",total:t(K)},null,8,["current-page","page-size","total"])],4),R(c("div",{class:"right-div",style:O({width:t(D)?"29%":""})},[c("div",ot,[c("p",null,[nt,d(H(t(L)),1)])]),R((f(),le("div",{class:"tree-div","element-loading-text":"加载中","element-loading-spinner":"el-icon-loading",style:O({height:t(W)+"px"})},[a(Y,{ref:"menuTree","node-key":"id",props:t(de),data:t(ie),"expand-on-click-node":!1,"check-strictly":!0,"show-checkbox":""},{default:s(({node:o,data:w})=>[a(X,{style:{color:"#409eff","font-size":"16px","vertical-align":"middle"}},{default:s(()=>[(f(),h(Me(l.$icon[ye(o,w)])))]),_:2},1024),c("span",rt,H(w.name),1)]),_:1},8,["props","data"])],4)),[[ee,t(F)]]),c("div",it,[a(u,{size:"small",type:"primary",onClick:we},{default:s(()=>[d("保存")]),_:1}),a(u,{size:"small",onClick:e[2]||(e[2]=o=>D.value=!1)},{default:s(()=>[d("取消")]),_:1})])],4),[[He,t(D)]]),a(Z,{title:t(q)?"新增":"修改",modelValue:t(_),"onUpdate:modelValue":e[13]||(e[13]=o=>P(_)?_.value=o:null),class:"detail-visiable","close-on-click-modal":!1,"close-on-press-escape":!1},{default:s(()=>[c("div",dt,[a(Q,{inline:!0,model:t(m),rules:t(oe),labelWidth:"120px",ref:"userForm"},{default:s(()=>[a(b,{label:"登录账号:",prop:"account"},{default:s(()=>[a(v,{modelValue:t(m).account,"onUpdate:modelValue":e[3]||(e[3]=o=>t(m).account=o),placeholder:"登录账号",size:"small"},null,8,["modelValue"])]),_:1}),a(b,{label:"用户姓名:",prop:"name"},{default:s(()=>[a(v,{modelValue:t(m).name,"onUpdate:modelValue":e[4]||(e[4]=o=>t(m).name=o),placeholder:"用户姓名",size:"small"},null,8,["modelValue"])]),_:1}),a(b,{label:"所属机构:",prop:"deptName"},{default:s(()=>[a(v,{placeholder:"请选择机构",modelValue:t(m).deptName,"onUpdate:modelValue":e[6]||(e[6]=o=>t(m).deptName=o),size:"small"},{append:s(()=>[a(X,{onClick:e[5]||(e[5]=o=>z.value=!0)},{default:s(()=>[a(Te)]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"手机号码:"},{default:s(()=>[a(v,{modelValue:t(m).phone,"onUpdate:modelValue":e[7]||(e[7]=o=>t(m).phone=o),placeholder:"手机号码",size:"small"},null,8,["modelValue"])]),_:1}),a(b,{label:"登录密码:",prop:"password"},{default:s(()=>[a(v,{type:"password",modelValue:t(m).password,"onUpdate:modelValue":e[8]||(e[8]=o=>t(m).password=o),placeholder:"登录密码",size:"small"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),a(Z,{width:"30%",title:"机构",modelValue:t(z),"onUpdate:modelValue":e[11]||(e[11]=o=>P(z)?z.value=o:null),"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":""},{default:s(()=>[a(v,{placeholder:"输入关键字进行过滤",modelValue:t($),"onUpdate:modelValue":e[9]||(e[9]=o=>P($)?$.value=o:null),size:"small",style:{"margin-bottom":"10px"}},null,8,["modelValue"]),a(Y,{props:t(re),data:t(ne),"filter-node-method":he,onNodeClick:ze,"node-key":"id",ref:"orgTree","expand-on-click-node":!1,style:{height:"300px"}},{default:s(({node:o,data:w})=>[c("span",ut,"["+H(w.deptId)+"]"+H(o.label),1)]),_:1},8,["props","data"]),c("div",ct,[a(u,{type:"primary",size:"small",onClick:De},{default:s(()=>[d("确定")]),_:1}),a(u,{onClick:e[10]||(e[10]=o=>z.value=!1),size:"small"},{default:s(()=>[d("取消")]),_:1})])]),_:1},8,["modelValue"]),c("div",mt,[t(C)?V("",!0):(f(),h(u,{key:0,size:"small",type:"primary",onClick:Ce},{default:s(()=>[d("保存")]),_:1})),t(C)?(f(),h(u,{key:1,size:"small",type:"primary",loading:!0},{default:s(()=>[d("保存中")]),_:1})):V("",!0),a(u,{onClick:e[12]||(e[12]=o=>_.value=!1),size:"small"},{default:s(()=>[d("取消")]),_:1})])]),_:1},8,["title","modelValue"])])}}}),Vt=Be(ft,[["__scopeId","data-v-d0d1453f"]]);export{Vt as default};
